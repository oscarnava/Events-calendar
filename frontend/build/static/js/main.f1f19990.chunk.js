(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){e.exports=n(23)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(10),s=n.n(i),c=(n(17),n(1)),o=n.n(c),u=n(2),l=n(3),d=n(5),h=n(4),m=n(6),v=n(11),f="https://events-calendar-morelia.herokuapp.com",p=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,y=function e(t){switch(typeof t){case"object":return t&&Object.keys(t).forEach((function(n){t[n]=e(t[n])})),t;case"string":return t.match(p)?new Date(t):t;default:return t}},g=function(e){var t=e.method,n=void 0===t?"GET":t,a=e.path,r=void 0===a?"":a,i=e.body,s=void 0===i?null:i,c=Object(v.a)(e,["method","path","body"]),o={method:n,headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:s&&JSON.stringify(s),mode:"cors",cache:"default"};return fetch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.keys(t).map((function(e){return"/".concat(e,"/").concat(t[e])})).join("");return"".concat(f).concat(n,"/").concat(e)}(r,c),o).then((function(e){return e.json()})).then((function(e){if("ok"!==e.status)throw Error(e.status);return e.payload})).then(y)},b=function(){return g({path:"events"})},E=function(e,t){return g({method:"POST",path:"users",body:{name:e,email:t}})},k=function(e){return g({users:e})},O={create:function(e,t){return g({method:"POST",path:"userevents",events:t.id,users:e.name})},update:function(e,t){return g({method:"PUT",userevents:e,body:{rating:t}})},delete:function(e){return g({method:"DELETE",userevents:e})}},C=(n(19),n(8)),j=n(7),S=n.n(j),N=(n(20),function(e){return new Date(864e5*Math.floor(e/864e5))}),M=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).handleShowMore=function(){var e=n.state.extended;n.setState({extended:!e})},n.handleLinkBtnClick=function(){var e,t;return o.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.state.scheduled,!(t=n.props.onChange(Object(C.a)(n),{scheduled:!e}))){a.next=5;break}return a.next=5,o.a.awrap(t.then((function(){n.setState({scheduled:!e})})));case 5:case"end":return a.stop()}}))},n.state={extended:!!e.extended,rating:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"updateState",value:function(e){var t=e.scheduled,n=e.rating;this.setState({scheduled:t,rating:n})}},{key:"formattedSchedule",value:function(){if(this.isSingleDay){var e=this.props.info,t=e.begins,n=e.ends;return t%864e5===n%864e5?"On ".concat(S()("dd/MM/yyyy",this.beginDay),", at ").concat(S()("hh:mm",t)):"On ".concat(S()("dd/MM/yyyy",this.beginDay),", from ").concat(S()("hh:mm",t)," to ").concat(S()("hh:mm",n))}var a=this.props.info,r=a.begins,i=a.ends;return"From ".concat(S()("dd/MM/yyyy at hh:mm",r)," to ").concat(S()("dd/MM/yyyy at hh:mm",i))}},{key:"render",value:function(){var e=this.props.info,t=e.title,n=e.description,a=e.category,i=this.state,s=i.extended,c=i.scheduled,o=i.rating,u=void 0!==c;return r.a.createElement("div",{className:"Event"},r.a.createElement("div",{className:"time-line"}),r.a.createElement("div",{className:"schedule"},this.formattedSchedule()),r.a.createElement("div",{className:"rating"},o),r.a.createElement("div",{className:"title"},t),r.a.createElement("div",{className:"description",style:s?{}:{display:"none"}},s?n:""),r.a.createElement("div",{className:"category"},a),r.a.createElement("button",{type:"button",className:"btn ".concat(c?"scheduled":"add"),style:u?{}:{display:"none"},onClick:this.handleLinkBtnClick},r.a.createElement("span",null,c?"- schedule":"+ schedule")),r.a.createElement("button",{type:"button",className:"more",onClick:this.handleShowMore},s?"Show less":"Show more"))}},{key:"id",get:function(){return this.props.info.id}},{key:"beginDay",get:function(){return N(this.props.info.begins)}},{key:"endDay",get:function(){return N(this.props.info.ends)}},{key:"isSingleDay",get:function(){return Math.floor(this.beginDay)===Math.floor(this.endDay)}}]),t}(r.a.Component),I=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={events:null},n.eventNodes={},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"updateEvent",value:function(e,t){var n=t.scheduled,a=t.rating;this.eventNodes[e].current.updateState({scheduled:n,rating:a})}},{key:"render",value:function(){var e=this,t=this.props.onChange,n=this.state.events;return r.a.createElement("div",{className:"events-list"},n?n.map((function(n){var a=n.id;return e.eventNodes[a]=e.eventNodes[a]||r.a.createRef(),r.a.createElement(M,{key:a,ref:e.eventNodes[a],info:n,onChange:t})})):"Loading...")}},{key:"eventsInfo",set:function(e){this.setState({events:e})}}]),t}(r.a.Component),w=(n(21),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).linkByEventId=function(e){var t=n.state.events;return t?t.find((function(t){var n=t.event_id;return e===n})):null},n.hideForm=function(){n.setState({formVisible:!1})},n.handleLogClick=function(e){var t=e.target.dataset.login;n.nameInput.current.value="Monstruo",n.emailInput.current.value="",n.setState({formVisible:!0,login:t})},n.handleSubmitClick=function(){""!==n.nameInput.current.value?(n.state.login?n.doLogin():n.doSignup()).catch((function(e){var t=e.message;alert(t)})).finally(n.hideForm):n.hideForm()},n.state={name:null,formVisible:!1,login:!0,events:null},n.nameInput=r.a.createRef(),n.emailInput=r.a.createRef(),n.scheduleMemo=null,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){this.state.formVisible&&this.nameInput.current.focus()}},{key:"addEvent",value:function(e){var t=e.id,n=e.event_id,a=e.rating;this.scheduleMemo=null;var r=this.state.events;r.push({id:t,event_id:n,rating:a}),this.setState({events:r})}},{key:"removeEvent",value:function(e){var t=e.id;this.scheduleMemo=null;var n=this.state.events;this.setState({events:n.filter((function(e){return e.it!==t}))})}},{key:"doOnChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.scheduleMemo=null,this.setState({name:e,events:t}),this.props.onChange(e,t)}},{key:"doSignup",value:function(){var e,t,n=this;return o.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e=this.nameInput.current.value,t=this.emailInput.current.value,a.abrupt("return",E(e,t).then((function(e){var t=e.name;n.doOnChange(t)})));case 3:case"end":return a.stop()}}),null,this)}},{key:"doLogin",value:function(){var e,t=this;return o.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=this.nameInput.current.value,n.abrupt("return",k(e).then((function(e){var n=e.name,a=e.userevents;t.doOnChange(n,a)})));case 2:case"end":return n.stop()}}),null,this)}},{key:"render",value:function(){var e=this.state,t=e.login,n=e.formVisible;return r.a.createElement("div",{className:"User"},r.a.createElement("div",{className:"name",style:this.name?{}:{fontSize:"0.9rem",color:"lightgrey"}},this.name?"Welcome ".concat(this.name,"!"):"Login to save your schedule  \u2933"),r.a.createElement("button",{type:"button",className:"login","data-login":!0,onClick:this.handleLogClick},"Login"),r.a.createElement("button",{type:"button",className:"signup",onClick:this.handleLogClick},"Signup"),r.a.createElement("div",{className:"form",style:n?{}:{display:"none"}},r.a.createElement("input",{type:"input",className:"name-in",ref:this.nameInput,placeholder:"Name"}),r.a.createElement("input",{type:"email",className:"email-in",ref:this.emailInput,placeholder:"email",style:t?{display:"none"}:{}}),r.a.createElement("button",{type:"button",className:"submit",onClick:this.handleSubmitClick},t?"Log In":"Sign Up"),r.a.createElement("button",{type:"button",className:"cancel",onClick:this.hideForm},"Cancel")))}},{key:"name",get:function(){return this.state.name}},{key:"schedule",get:function(){var e=this;if(this.scheduleMemo)return this.scheduleMemo;var t=this.state.events;return this.scheduleMemo={},t.forEach((function(t){var n=t.id,a=t.event_id,r=t.rating;e.scheduleMemo[a]={id:n,rating:r}})),this.scheduleMemo}}]),t}(r.a.Component)),L=(n(22),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).addEventToUser=function(e){return O.create(n.user.current,e).then((function(e){n.user.current.addEvent(e)})).catch((function(e){var t=e.message;alert(t)}))},n.removeEventFromUser=function(e){var t=n.user.current.schedule;return O.delete(t[e.id].id).then((function(e){n.user.current.removeEvent(e)})).catch((function(e){var t=e.message;alert(t)}))},n.handleOnUserChange=function(e,t){var a=n.user.current.schedule,r=n.eventsList.current;n.eventsInfo.forEach((function(e){var t=e.id,n=a[t],i=n?{scheduled:!0,rating:n.rating}:{scheduled:null,rating:null};r.updateEvent(t,i)}))},n.handleOnEventChange=function(e,t){var a=t.scheduled;t.rating;return n.user.current.name&&void 0!==a?a?n.addEventToUser(e):n.removeEventFromUser(e):null},n.user=r.a.createRef(),n.eventsList=r.a.createRef(),n.eventsInfo=null,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;return o.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.awrap(b().then((function(t){e.eventsList.current&&(e.eventsInfo=t.sort((function(e,t){return e.begins-t.begins})),e.eventsList.current.eventsInfo=e.eventsInfo)})));case 2:case"end":return t.stop()}}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"main-header"},r.a.createElement(w,{ref:this.user,onChange:this.handleOnUserChange}),r.a.createElement("h1",null,"Events")),r.a.createElement(I,{ref:this.eventsList,onChange:this.handleOnEventChange}))}}]),t}(r.a.Component));s.a.render(r.a.createElement(L,null),document.getElementById("root"))}],[[12,1,2]]]);
//# sourceMappingURL=main.f1f19990.chunk.js.map